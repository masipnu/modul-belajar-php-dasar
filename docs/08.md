## Penanganan Database

- Penanganan database merupakan tujuan utama dalam penggunaan PHP.
- Dengan database, data yang diproses oleh PHP dapat disimpan dan dapat digunakan setiap saat.
- Database yang paling umum digunakan dengan bahasa PHP adalah MySQL, MariaDB dan PostgreSQL.

## Database Functions

Berikut daftar function bawaan PHP yang bisa kita gunakan untuk berkomunikasi dengan database.

|Function | Keterangan |
|-|-|
|`mysqli_affected_row(koneksi)`|Menghasilkan jumlah baris yang terpengaruh oleh operasi MySQL sebelumnya.|
|`mysqli_autocommit(koneksi, mode)`|Mengeset modifikasi database langsung diproses atau tidak.|
|`mysqli_change_user(koneksi, username, password, dbname)`|Mengubah user pada koneksi database.|
|`mysqli_character_set_name(koneksi)`|Menghasilkan karakter default pada koneksi database.|
|`mysqli_close(koneksi)`|Menutup koneksi database.|
|`mysqli_commit(koneksi)`|Memproses transaksi database saat ini.|
|`mysqli_connect_errorno()`|Menghasilkan kode error dari koneksi terakhir.|
|`mysqli_connect_error()`|Menghasilkan deskripsi error dari koneksi terakhir.|
|`mysqli_connect(host, username, password, dbname, port, socket)`|Membuka koneksi baru ke MySQL server.|
|`mysqli_data_seek(result, offset)`|Menuju baris tertentu dari data yang dihasilkan.|
|`myqsli_debug(message)`|Debug operasi database.|
|`mysqli_dump_debug_info(koneksi)`|Menghasilkan info debug ke log.|
|`mysqli_errno(koneksi)`|Menghasilkan kode error terakhir dari beberapa operasi database.|
|`mysqli_error_list(koneksi)`|Menghasilkan daftar error dari beberapa operasi database.|
|`mysqli_error(koneksi)`|Menghasilkan deskripsi error terakhir dari beberapa operasi database.|
|`mysqli_fetch_all(result, result_type)`|Menghasilkan array asosiatif, array numerik atau keduanya dari semua hasil operasi database. `result_type` dapat diisi `MYSQLI_ASSOC`,`MYSQLI_NUM`,`MYSQLI_BOTH`.|
|`mysqli_fetch_array(result, result_type)`|Menghasilkan array asosiatif, array numerik atau keduanya dari hasil operasi database.|
|`mysqli_fetch_assoc(result)`|Menghasilkan array asosiatif dari hasil operasi dataabse.|
|`mysqli_fetch_field_direct(result, field_number)`|Menghasilkan meta-data sebuah field dari hasil operasi database, sebagai sebuah objek.|
|`mysqli_fetch_field(result)`|Menghasilkan field berikutnya dari hasil operasi database, sebagai sebuah objek.|
|`mysqli_fetch_fields(result)`|Menghasilkan array objek yang merepresentasikan field dari hasil operasi database.|
|`mysqli_fetch_lengths(result)`|Menghasilkan jumlah kolom dari baris saat ini.|
|`mysqli_fetch_object(result, classname, parameter)`|Menghasilkan baris dari hasil operasi database sebagai objek.|
|`mysqli_fetch_row(result)`|Menghasilkan array numerik dari satu baris hasil operasi database.|
|`mysqli_field_count(koneksi)`|Menghasilkan jumlah kolom dari query sebelumnya.|
|`mysqli_field_seek(result, field_number)`|Menuju field tertentu.|
|`mysqli_field_tell(result)`|Menghasilkan posisi field saat ini.|
|`mysqli_free_result(result)`|Mengosongkan data dari hasil operasi database.|
|`mysqli_get_client_info(koneksi)`|Menghasilkan versi client library MySQL.|
|`mysqli_get_connection_stats(koneksi)`|Menghasilkan statistik mengenai koneksi client.|
|`mysqli_get_host_info(koneksi)`|Menghasilkan nama host server MySQL dan tipe koneksi.|
|`mysqli_get_proto_info(koneksi)`|Menghasilkan versi protokol MySQL.|
|`mysqli_get_server_info(koneksi)`|Menghasilkan versi server MySQL.|
|`mysqli_get_server_version(koneksi)`|Menghasilkan versi server MySQL sebagai integer.|
|`mysqli_info(koneksi)`|Menghasilkan informasi tentang query yang dieksekusi baru-baru ini.|
|`mysqli_init()`|Menginisialisasi MySQLi dan menghasilkan resource untuk digunakan dengan `mysqli_real_connection()`.|
|`mysqli_insert_id(koneksi)`|Menghasilkan id yang dihasilkan otomatis dari query terakhir.|
|`mysqli_more_results(koneksi)`|Mengecek apakah ada hasil dari beberapa query.|
|`mysqli_multi_query(koneksi, query)`|Memproses beberapa query.|
|`mysqli_next_result(koneksi)`|Mempersiapkan hasil berikutnya dari `mysqli_multi_query()`.|
|`mysqli_num_fields(result)`|Menghasilkan jumlah field dari hasil operasi database.|
|`mysqli_num_rows(result)`|Menghasilkan jumlah baris dari hasil operasi database.|
|`mysqli_options(koneksi, option, value)`|Menambahkan pengaturan pada koneksi database.|
|`mysqli_ping(koneksi)`|Mengetes koneksi server atau mencoba koneksi ulang jika koneksi bermasalah.|
|`mysqli_query(koneksi, query, resultmode)`|Memproses query ke database. `resultmode` dapat diisi `MYSQLI_USE_RESULT`, `MYSQLI_STORE_RESULT`.|
|`mysqli_real_connect(koneksi, host, username, password, dbname, port, socket, flag)`|Membuka koneksi baru ke MySQL server.|
|`mysqli_real_escape_string(koneksi, escapestring)`|Meloloskan karakter khusus pada string untuk digunakan pada perintah SQL.|
|`mysqli_select_db(koneksi, dbname)`|Mengubah database yang terkoneksi.|

Untuk dapat menggunakan function-function di atas, pastikan kamu telah menginstall MySQL/ MariaDB server dan memiliki database di dalamnya.

## Praktik Koneksi Database

Agar dapat lebih memahami fungsi-fungsi database pada bahasa pemrograman PHP, mari kita melakukan uji coba.

### Instalasi Server

!!! warning "Perhatian"
    Jika anda sudah mempelajari [**Tutorial Database MySQL**](https://masipnu.github.io/tutorial-mysql/) dari panduan yang telah saya buat, maka anda bisa melewai langkah ini.

Sebelum mengakses database menggunakan PHP, silahkan install dulu salah satu server database berikut.

- MySQL [ **⬇️ Link Download**](https://dev.mysql.com/downloads/mysql/)
- MariaDB [ **⬇️ Link Download**](https://mariadb.org/download/?t=mariadb&p=mariadb&r=11.6.2&os=windows&cpu=x86_64&pkg=msi&mirror=vhost_sg)

Saya sendiri sebenarnya lebih suka ==MariaDB==, karena aplikasinya opensource dan saat ini lebih aktif dikembangkan daripada MySQL.


### Konfigurasi


#### Setting Ekstensi `mysqli`

!!! warning "Perhatian"
    Jika anda praktik menggunakan paket aplikasi XAMPP, Laragon, AppServ, Uwamp, USBWebserver atau yang lain, anda bisa melewati langkah ini.

Karena sejak awal saya praktik menjakankan file php menggunkanan command promt/ terminal pada aplikasi Visual Studio Code dengan memanfaatkan file binary `php.exe`, maka jika kita akan bekerja dengan database MySQL/ MariaDB kita perlu mengaktifkan ekstensi `mysqli`. Berikut langkah-langkahnya.

1. Buka file eksporer dan masuk ke direktori file binary php, saya asumsikan di `C:\php`
2. Cari file `php.ini`. Jika file `php.ini` tidak ada, tentu ada file bernama `php.ini-development`. Maka copy-paste file tersebut dan rename menjadi `php.ini`
3. Buka file `php.ini` menggunakan Visual Studio Code, atau sebenarnya Notepad saja cukup.
4. Cari baris berikut
   ```ini
    ; Directory in which the loadable extensions (modules) reside.
    ; https://php.net/extension-dir
    ;extension_dir = "./"
    ; On windows:
    ;extension_dir = "ext"
   ```
5. Aktifkan pengaturan folder extension dengan menghapus tanda `;` di depan `extension_dir`, kurang lebihnya menjadi seperti ini.
    ```ini
    ; Directory in which the loadable extensions (modules) reside.
    ; https://php.net/extension-dir
    ;extension_dir = "./"
    ; On windows:
    extension_dir = "ext"
    ```
7. Selanjutnya cari baris berikut
    ```ini
    ;extension=mysqli
    ```
8. Aktifkan ekstensi `mysqli` dengan menghapus tanda `;` menjadi
    ```ini
    extension=mysqli
    ```

#### Membuat Sample Database

- Karena kita akan memanipulasi database, mari kita buat contoh databasenya.
- Pastikan service `MariaDB` / `MySQL` dalam kondisi running.
- Buka aplikasi HeidiSQL, lalu jalankan query berikut untuk membuat database, tabel beserta sample datanya.
  ```sql
  -- membuat database sekolah
  CREATE DATABASE sekolah;
  
  -- mengaktifkan database
  USE sekolah;

  -- membuat tabel
  CREATE table siswa(
  id INT AUTO_INCREMENT PRIMARY KEY,
  nama VARCHAR(100) NOT NULL,
  kelas INT(2) NOT NULL,
  jurusan VARCHAR(4) NOT NULL
  );

  -- menambah sample data
  INSERT INTO siswa
  (nama, kelas, jurusan) VALUES
  ("Dita Leni Ravia", 11, "PPLG" );
  ```
!!! note "Catatan"
    Anda tidak perlu menulis query di atas secara manual, copy saja dan paste ke tab `query` yang ada di aplikasi HeidiSQL dan jalankan dengan menekan tombol ++f9++.

#### File `config.php`

- Setelah berhasil mengaktifkan ekstensi `mysqli` selanjutnya kita buat folder baru untuk menyimpan skrip percobaan CRUD database MySQL dengan PHP.
- Misal, buat folder `crud`, lalu buat file-file php di dalamnya (sementara kosongan saja) dengan struktur berikut.
    ``` { .sh .no-copy }
    crud
    ├─ config.php
    ├─ edit.php
    ├─ hapus.php
    ├─ index.php
    └─ tambah.php
    ```
- Ketikkan skrip berikut ke dalam file `config.php`
  ```php
    <?php
    // Membuat konfigurasi database
    $host = "localhost";
    $user = "root";
    $pass = "";
    $db   = "sekolah";

    // Membuat handle
    $koneksi = mysqli_connect($host, $user, $pass, $db);

    // Melakukan pengecekan koneksi
    if(!$koneksi){
        die("Koneksi gagal: " . mysqli_connect_error());
    }
    ?>
  ```

!!! example "Uji Coba"
    - Mari kita uji coba koneksi ke database dengan menjalankan perintah `php -S localhost:80` di terminal, dan jangan ditutup.
    - Buka browser dan ketikkan `localhost/config.php`
    - Jika halaman kosong, itu tandanya skrip php berjalan lancar, bisa tersambung dengan database.
    - Namun sebaliknya, jika muncul pesan error, berarti ada yang bermasalah.
    - Cek lagi pengaturan `$password`, `$database`, `$koneksi` serta skrip dalam blok `if()`
    - Lalu jalankan ulang.


### Menampilkan Data (READ)

Ketikkan skrip berikut ke dalam file `index.php`, file inilah yang secara default akan diakses jika kita mengetikkan `localhost` pada browser.

```php
<title>Data Siswa</title>
<style>
    table{
        border-collapse:collapse;
    }
    th, td{
        border: 1px solid black;
        padding:10px;
        text-align:center;
    }
    th{
        background:#ccc;
    }
    a{
        text-decoration:none;
    }
</style>

<h2>Data Siswa</h2>
<p><a href="tambah.php"> Tambah Siswa </a></p>
<table>
    <thead>
        <th>No</th>
        <th>Nama</th>
        <th>Kelas</th>
        <th>Jurusan</th>
        <th>Aksi</th>
    </thead>
    <tbody>
<?php
include "config.php";
$query = "SELECT * FROM siswa";
$result = mysqli_query($koneksi, $query);

$no=1;
while($data = mysqli_fetch_assoc($result)){
?>
        <tr>
            <td><?=$no?></td>
            <td><?=$data['nama']?></td>
            <td><?=$data['kelas']?></td>
            <td><?=$data['jurusan']?></td>
            <td>
                <a href="edit.php?id=<?=$data['id']?>"> Edit </a> | 
                <a href="hapus.php?id=<?=$data['id']?>"> Hapus </a>
            </td>
        </tr>
<?php
$no++;
}
?>
    </tbody>
</table>
```
!!! example "Uji Coba"
    - File tersebut berisi campuran skrip HTML, CSS dan PHP.
    - Kode HTML dan CSS pada skrip berikut saya buat seminimal mungkin, dan tidak memenuhi kaidah penulisan yang ideal, namun secara fungsi sudah cukup.
    - Pahami cara menampilkan data dari database dengan blok perulangan `while`, lalu buka `localhost` pada web browser.


### Menambah Data (CREATE)

### Memperbaharui Data (UPDATE)

### Menghapus Data (DELETE)